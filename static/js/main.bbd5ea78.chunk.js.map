{"version":3,"sources":["chapter.js","map.js","index.js"],"names":["popups","book","undefined","book_chapters","Chapter","props","state","activeChapter","activeMark","MarksInChapter","onChapterCellClick","bind","onMarkCellClick","e","index","buf","i","marks","forEach","mark","push","id","value","this","setState","chapter_func","str","mark_func","mark_id","found","data","element","Array","prototype","map","call","chapter_struct","expandable","onClick","mark_name","expandble","React","Component","vwidth","document","documentElement","clientWidth","vheight","clientHeight","mapStyle","height","width","curr_point","L","latLng","curr_z","Map","style","mymap","setView","tileLayer","attribution","maxZoom","tileSize","accessToken","addTo","getCenter","getZoom","JSON","parse","chapters","name","load_book","App","activeStory","activeScreen","activePanelChapter","onStoryChange","onIntroClick","onChapterChange","onMarkSelect","currentTarget","dataset","story","activeView","paddingTop","paddingBottom","color","textAlign","size","mode","tabbar","selected","data-story","text","activePanel","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.bbd5ea78.chunk.js","sourcesContent":["import  React from 'react';\r\nimport { Panel, PanelHeader, List, Cell } from '@vkontakte/vkui';\r\n\r\nvar popups = [];\r\nvar book = undefined;\r\nvar book_chapters = [];\r\n\r\n\r\n//Процедура загрузки книги\r\nfunction load_book(str) {\r\n  book = JSON.parse(str);\r\n\r\n  for (var i = 1; i !== book.chapters; i++)\r\n    book_chapters.push({id: i, value: [book.data[i].name, i, book.data[i].marks]});\r\n};\r\n\r\n\r\nexport default class Chapter extends React.Component {\r\n  constructor (props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      activeChapter: 1,\r\n      activeMark: \"\",\r\n      MarksInChapter: []\r\n    };\r\n    this.onChapterCellClick = this.onChapterCellClick.bind(this);\r\n    this.onMarkCellClick = this.onMarkCellClick.bind(this);\r\n  }\r\n  onChapterCellClick(e, index) {\r\n    var buf = []\r\n    var i = 0\r\n    book_chapters[index - 1].marks.forEach(mark => {\r\n      buf.push({id: i, value: mark});\r\n      ++i;\r\n    });\r\n    this.setState({activeChapter: index, MarksInChapter: buf});\r\n    this.props.chapter_func();\r\n  }\r\n  onMarkCellClick(e, str) {\r\n    this.setState({activeMark: str});\r\n    this.props.mark_func();\r\n    var mark_id = this.state.MarksInChapter[this.state.activeMark];\r\n    var found = false;\r\n    book_chapters[this.state.activeChapter - 1].data.forEach(element => {\r\n      if (found) \r\n        popups.push(element);\r\n      if (element[0] === \"mark\" && element[1] === mark_id) {\r\n        found = true;\r\n      }\r\n    });\r\n  }\r\n  render() {\r\n    return(\r\n      <>\r\n      <Panel id=\"chapter_select\">\r\n        <PanelHeader>Выбор главы</PanelHeader>\r\n        <List>\r\n          {Array.prototype.map.call(book_chapters, function (chapter_struct) {\r\n            return <Cell expandable onClick={(e) => this.onChapterCellClick(e, chapter_struct.value[1])}>Глава {chapter_struct.value[1]}: {chapter_struct.value[0]}</Cell>;\r\n          }, this)}\r\n        </List>\r\n      </Panel>\r\n      <Panel id=\"mark_select\">\r\n        <PanelHeader>Выбор закладки</PanelHeader>\r\n        <List>\r\n          {Array.prototype.map.call(this.state.MarksInChapter, function (mark_name) {\r\n            return <Cell expandble onClick={(e) => this.onMarkCellClick(e, mark_name.value[0])}>{mark_name.value[1]}</Cell>;\r\n          }, this)}\r\n        </List>\r\n      </Panel> \r\n      </>           \r\n    );\r\n  }\r\n}\r\n\r\nexport { popups, load_book };","//Импорт библиотек\r\nimport React from 'react';\r\nimport L from 'leaflet'; \r\nimport popups from './chapter.js';\r\n\r\nvar vwidth = document.documentElement.clientWidth;   //Ширина\r\nvar vheight = document.documentElement.clientHeight; //Высота Viewport\r\n\r\nlet mapStyle = { //Структура стиля карты\r\n      height: vheight,\r\n      width: vwidth\r\n};\r\n//Если ширина экрана меньше высоты (мобильный экран)\r\nif (vwidth < vheight)\r\n  mapStyle.height = vwidth; //Делаем карту квадратной\r\nelse\r\n  mapStyle.height = mapStyle.height - 102; //В ином случае заполняем весь Viewport\r\n\r\n\r\nvar curr_point = L.latLng(55.7522, 37.6156); //Текущие координаты карты\r\nvar curr_z = 14; //Текущее увеличение карты\r\n\r\n\r\n//Класс карты\r\nexport default class Map extends React.Component {\r\n    //Рендер DOM\r\n    render() {\r\n        return (\r\n            <div id=\"mapid\" style={mapStyle}></div>\r\n        );\r\n    }\r\n\r\n    //Вторичный рендер данных карты\r\n    componentDidMount() {\r\n        //Создаём объект карты\r\n        this.mymap = L.map('mapid').setView(curr_point, curr_z);\r\n        //Отправляем запрос в Mapbox \r\n        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {\r\n            attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n            maxZoom: 18,\r\n            id: 'black-horse/ck9423ydx3ezj1ip93plhxxbb',\r\n            tileSize: 256,\r\n            accessToken: 'sk.eyJ1IjoiYmxhY2staG9yc2UiLCJhIjoiY2thM3RlcWNkMG5tcTNlb2dxenU5bjRseCJ9.68X_Tq_a4Lk8iuUDFQCC_g'\r\n        }).addTo(this.mymap);\r\n    }\r\n\r\n    //Удаление элемента с экрана\r\n    componentWillUnmount() {\r\n        //Запоминаем текущие параметры\r\n        curr_point = this.mymap.getCenter();\r\n        curr_z = this.mymap.getZoom();\r\n        //Очищаем память\r\n        this.mymap = null;\r\n    }\r\n}","import * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { Root, Epic, View, Panel, PanelHeader, Tabbar, TabbarItem, Button, Div } from '@vkontakte/vkui';\nimport Icon28GlobeOutline from '@vkontakte/icons/dist/28/globe_outline';\nimport Icon28ListOutline from '@vkontakte/icons/dist/28/list_outline';\nimport './vkui.css';\n\nimport Map from './map.js';\nimport Chapter, { load_book } from './chapter.js';\n\nload_book('{\"book_name\": \"Мастер и Маргарита\",\"chapters\": 2,\"data\": {\"1\" : {\"name\": \"Первая глава\",\"marks\": [[\"0\", \"Начало\"],[\"1\", \"Середина\"],[\"end\", \"Конец\"]], \"data\": [[\"mark\", \"0\"],[\"Кот\", [55.7522, 37.6156], 2],[\"Кот\", [55.7622, 37.7156], 4, \"smth\"],\t[\"mark\", \"1\"],[\"del\", \"Кот\"],[\"mark\", \"2\"],[\"Мастер\", [55.8522, 37.5956], 3]]},\"2\" : {\"name\": \"Вторая глава\",\"marks\": [[\"0\", \"Начало\"],[\"center\", \"Середина\"],[\"1\", \"Середина\"],[\"end\", \"Конец\"]],\"data\": [[\"mark\", \"0\"],[\"Азазелло\", [55.7522, 37.6156], 2],[\"Бегемот\", [55.7522, 37.6156], 4],\t[\"mark\", \"1\"],[\"del\", \"Бегемот\"],[\"mark\", \"center\"],[\"Азазелло\", [55.8522, 37.5956], 3],[\"mark\", \"end\"],[\"del\", \"Азазелло\"]]}} }');\n\nclass App extends React.Component {\n  constructor (props) {\n    super(props);\n\n    this.state = {\n      activeStory: 'map',\n      activeScreen: 'intro',\n      activePanelChapter: 'chapter_select'\n    };\n    this.onStoryChange = this.onStoryChange.bind(this);\n    this.onIntroClick = this.onIntroClick.bind(this);\n    this.onChapterChange = this.onChapterChange.bind(this);\n    this.onMarkSelect = this.onMarkSelect.bind(this);\n  }\n\n  onStoryChange (e) {\n    this.setState({ activeStory: e.currentTarget.dataset.story });\n  }\n\n  onIntroClick (e) {\n    this.setState({ activeScreen: 'things' });\n  }\n\n  onChapterChange (e) {\n    this.setState({ activePanelChapter: 'mark_select' });\n  }\n\n  onMarkSelect (e) {\n    this.setState({ activePanelChapter: 'chapter_select', activeStory: 'map'});\n  }\n\n  render() {\n    return (\n      <Root activeView={this.state.activeScreen}>\n        <View id=\"intro\">         \n          <Div style={{ paddingTop: 60, paddingBottom: 60, color: 'gray' }}>\n            <p style={{textAlign: 'center'}}>Добро пожаловать!</p>\n            <p>Это приложение разработано группой юных аналитиков в рамках проектной деятельности в Академии Калашников. Оно поможет людям, любящим книги и путешествия, узнать побольше о тех местах, \n            где происходили события из книги, и даже пройти по маршрутам её героев. Приложение понятно и легко в использовании.</p>\n            <p>Продукт находится в активной разработке и совсем скоро сможет порадовать интересными новинками! Так что обязательно оставляйте обратную связь разработчикам или пишите свои пожелания!</p>\n            <Button size=\"xl\" mode=\"secondary\" onClick={this.onIntroClick}>\n              Продолжить\n            </Button>\n          </Div>\n        </View>\n        <Epic id=\"things\" activeStory={this.state.activeStory} tabbar={\n          <Tabbar>\n            <TabbarItem\n              onClick={this.onStoryChange}\n              selected={this.state.activeStory === 'map'}\n              data-story=\"map\"\n              text=\"Просмотр\"\n            ><Icon28GlobeOutline/></TabbarItem>\n            <TabbarItem\n              onClick={this.onStoryChange}\n              selected={this.state.activeStory === 'chapter'}\n              data-story=\"chapter\"\n              text=\"Главы\"\n            ><Icon28ListOutline/></TabbarItem>\n          </Tabbar>\n        }> \n          <View id=\"map\" activePanel=\"map\">\n            <Panel id=\"map\">\n              <PanelHeader>Карта</PanelHeader>\n              <Map/>\n            </Panel>\n          </View>\n          <View id=\"chapter\" activePanel={this.state.activePanelChapter}>\n            <Chapter chapter_func={this.onChapterChange} mark_func={this.onMarkSelect}/>\n          </View>\n        </Epic>\n      </Root>\n    )\n  }\n}\n\nReactDOM.render(<App/>, document.getElementById('root'));"],"sourceRoot":""}